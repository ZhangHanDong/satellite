<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1" />
<meta http-equiv="Content-Language" content="en-us" />

<title><%= @title %> - Satellite</title>

<link type="text/css" href="/static/screen.css" media="screen, projection" rel="stylesheet"/>
<link type="text/css" href="/static/print.css" media="print" rel="stylesheet"/>

<meta name="MSSmartTagsPreventParsing" content="true" />
<meta name="author" content="Ken Pratt" />

<link rel="shortcut icon" href="/favicon.ico" />

<script type="text/javascript" src="/static/lib/jquery-1.2.6.min.js"></script>
<script type="text/javascript" src="/static/lib/jquery-autocomplete/jquery.autocomplete.min.js"></script>
<script type="text/javascript" src="/static/hotkeys.js"></script>

<script type="text/javascript">
  localOnload = function() {}; // override on pages

  $(document).ready(function(){

    localOnload();

    // h => redirect to Home
    HotKeys.add('h', redirect('<%= @uri.home %>'));

    // a => redirect to Add page
    HotKeys.add('a', redirect('<%= @uri.new_page %>'));

    // l => redirect to List pages
    HotKeys.add('l', redirect('<%= @uri.list %>'));

    // s => focus search box
    HotKeys.add('s', function() { $("#search-box-query").focus() });

    // g => focus goto box
    HotKeys.add('g', function() { $("#goto").focus() });

    HotKeys.attach();

    // page data for autocomplete
    var data = [ <%= @pages.collect {|p| "{ name: '#{p.name}', url: '#{@uri.page(p.name)}' }" }.join(', ') %> ];

    // goto autocomplete box
    $("#goto").autocomplete(data, {
      formatItem: function(page) {
        return page.name;
      }
    }).result(function(event, page) {
      location.href = page.url;
    });

  });
</script>

</head>
<body>
  <div id="wrapper">
    <div id="header">
      <h1><a href="/"><span>Satellite</span></a></h1>
    </div>

    <div id="content-box">
      <div id="search-box">
        <form id="searchBox" action="<%= @uri.search %>" method="get">
          <label for="search-box-query">Search:</label>
          <input id="search-box-query" name="query" size="20" value="" />
        </form>
      </div>

      <% if @error %><p class="error"><%= @error %></p><% end %>
      <% if @conflicts.any? %>
        <div class="conflicts">
          <h4>Warning</h4>
          <p>
            Conflicts occurred during the last sync operation. Please
            resolve the following pages as soon as possible:
          </p>
          <ul>
            <% for page in @conflicts %>
              <li><a href="<%= @uri.resolve_conflict(page.name) %>">Resolve '<%= page.name %>'</a></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <h2><%= @title %></h2>

      <%= @inner %>
    </div>

    <div id="footer-box">
      <div id="menu">
        <a href="<%= @uri.home %>">Home</a> |
        <a href="<%= @uri.new_page %>">Add page</a> |
        <a href="<%= @uri.list %>">List pages</a> |
        <a href="<%= @uri.search %>">Search</a> |
        Go to: <input id="goto" value="" onchange="" />
      </div>
    </div>
  </div>
</body>
</html>
